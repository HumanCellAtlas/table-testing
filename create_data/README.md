# Generating test data

The test data can be generated by building the docker image defined and running it:

```bash
docker build -t matrix_data .
docker run -v /path/to/data:/data matrix_data --data-yaml /data/data.yaml --data-path /data
```

The image has an entrypoint that expects two arguments:
- --data-yaml: The path, within the docker container, to the `data.yaml` file that defines the sources and formats to create.
- --data-path: The path, again within the docker container, where the output expression matrices should be written.

The command above assumes the `data.yaml` file exists at `/path/to/data/data.yaml`, and it will place all of the created matrices in subdirectories of `/path/to/data`.

# Adding new data sources

The data sources are defined in the `sources` section of [data.yaml](create_data/data.yaml). Each object has the following keys:

- url: The url where the source data can be downloaded
- type: The type of the source data. There has to be a function called `convert_from_{type}` in [converters.py](create_data/converters.py) that can convert the source data into a pandas dataframe
- multiple_matrices: Whether the data source contains multiple source matrices
- args: Any additional keyword arguments to pass to the `convert_from_{type} function

So adding a data source requires three things:
1. Add an entry to [data.yaml](create_data/data.yaml)
2. Make sure there is an appropriate `convert_from_{type}` in [converters.py](create_data/converters.py)
3. Add any dependencies to the [Dockerfile](create_data/Dockerfile]

# Adding new output formats

Adding new output formats is similar to adding new data sources. The formats are defined in the `outputs` section of [data.yaml](create_data/data.yaml). Each object has the following keys:

- format: Defines the function in [converters.py](create_data/converters.py) to use to convert from a pandas dataframe to this file format. The function must be named `convert_to_{format}`
- args: Any additional keyword arguments to pass to the `convert_to_{format}` object

